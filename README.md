# SKN06-3rd-5Team

3ì°¨ ë‹¨ìœ„ í”„ë¡œì íŠ¸ - ì•ˆí˜•ì§„, ì¡°í•´ì›, ì „ìˆ˜ì—°, ì„ì—°ê²½, ë°•ë¯¸í˜„


## ê°‘ì§„ íŒŒì´ë¸Œ âœ‹ğŸ»
### íŒ€ì›
| ì•ˆí˜•ì§„ | ì¡°í•´ì› | ì „ìˆ˜ì—° | 
|:----------:|:----------:|:----------:|
|<img src="https://github.com/SKNETWORKS-FAMILY-AICAMP/SKN06-3rd-5team/blob/main/%ED%98%95%EC%A7%84.png" alt="image" width="200" height="250"/> |<img src="https://github.com/SKNETWORKS-FAMILY-AICAMP/SKN06-3rd-5team/blob/main/%ED%95%B4%EC%9B%90.png" alt="image" width="200" height="250"/>|<img src="https://github.com/SKNETWORKS-FAMILY-AICAMP/SKN06-3rd-5team/blob/main/%EC%88%98%EC%97%B0.jpg" alt="image" width="350" height="250"/>|

</br>

| ì„ì—°ê²½ | ë°•ë¯¸í˜„ |
|:----------:|:----------:|
|<img src="https://github.com/SKNETWORKS-FAMILY-AICAMP/SKN06-3rd-5team/blob/main/%EC%97%B0%EA%B2%BD.png" alt="image" width="200" height="250"/>|<img src="https://github.com/SKNETWORKS-FAMILY-AICAMP/SKN06-3rd-5team/blob/main/%EB%AF%B8%ED%98%84.png" alt="image" width="200" height="250"/>|

# ğŸ¤– ì—­ì‚¬ì  ì¸ë¬¼ì´ë‚˜ ì‚¬ê±´ì— ëŒ€í•´ ì•Œë ¤ì£¼ëŠ” êµìœ¡ ì±—ë´‡ ğŸ¤–

### âœ” ê°œë°œ ê¸°ê°„                                                  
2024.12.24 ~ 2024.12.26 (ì´ 2ì¼)

## í”„ë¡œì íŠ¸ ê°œìš”
âœ” **ëª©í‘œ**
   > RAGê¸°ë°˜ ì§ˆì˜ì‘ë‹µì„ ì´ìš©í•œ ì—­ì‚¬ì  ì¸ë¬¼ì´ë‚˜ ì‚¬ê±´ì— ëŒ€í•´ ì§ˆë¬¸í•˜ë©´ ëŒ€ë‹µí•˜ëŠ” ì±—ë´‡ ê°œë°œ
   >
   1. ì—­ì‚¬ì— ëŒ€í•œ ê´€ì‹¬ ì¦ëŒ€
      > í•™ìƒë“¤ê³¼ ì¼ë°˜ ì‚¬ìš©ìê°€ ì—­ì‚¬ì  ì¸ë¬¼ê³¼ ì‚¬ê±´ì— ëŒ€í•´ ì‰½ê³  í¥ë¯¸ë¡­ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ë•ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•œë‹¤. ì´ë¥¼ í†µí•´ ì—­ì‚¬ê°€ ì§€ë‹Œ ì¤‘ìš”ì„±ê³¼ ì¬ë¯¸ë¥¼ ë°œê²¬í•  ìˆ˜ ìˆëŠ” ê¸°íšŒë¥¼ ì œê³µ
      
  2. ì§€ì‹ì˜ ëŒ€ì¤‘í™”
      > í•œêµ­ì‚¬ë¥¼ í¬í•¨í•œ ë‹¤ì–‘í•œ ì—­ì‚¬ì  ì£¼ì œë¥¼ ê°„ë‹¨í•˜ê³  ëª…ë£Œí•˜ê²Œ ì„¤ëª…í•˜ì—¬, ëˆ„êµ¬ë‚˜ ì‰½ê²Œ ì´í•´í•˜ê³  í•™ìŠµí•  ìˆ˜ ìˆëŠ” í™˜ê²½ì„ ì¡°ì„±í•œë‹¤. ì´ëŠ” íŠ¹íˆ ì—­ì‚¬ë¥¼ ì˜ ëª¨ë¥´ëŠ” ì‚¬ìš©ìë“¤ì—ê²Œ ìœ ìš©í•œ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ë° ì´ˆì ì„ ë§ì¶¤
      
  
  3. êµìœ¡ì  í™œìš© ê°€ëŠ¥ì„±
      > êµìœ¡ í˜„ì¥ì—ì„œ í•™ìƒë“¤ì˜ í•™ìŠµì„ ì§€ì›í•˜ëŠ” ë„êµ¬ë¡œ í™œìš©ë  ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì—­ì‚¬ì  ì¸ë¬¼ì˜ ì—…ì , ì‚¬ê±´ì˜ ë°°ê²½ê³¼ ê²°ê³¼ ë“±ì„ ì§ˆë¬¸í•˜ê³  ë‹µë³€í•˜ëŠ” ê³¼ì •ì„ í†µí•´ í•™ìŠµ íš¨ìœ¨ì„ ë†’ì´ê³  í˜¸ê¸°ì‹¬ ìê·¹
   
    
  4. ë¬¸í™”ìœ ì‚° ë³´ì¡´
      > ì—­ì‚¬ì  ìë£Œì™€ ì •ë³´ë¥¼ ë””ì§€í„¸í™”í•˜ì—¬ ë¯¸ë˜ ì„¸ëŒ€ê°€ ì§€ì†ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìì‚°ìœ¼ë¡œ ë³´ì¡´
     
     
      > íŠ¹íˆ, í•œêµ­ì‚¬ë¥¼ ë¹„ë¡¯í•œ ì „ ì„¸ê³„ì˜ ë‹¤ì–‘í•œ ì—­ì‚¬ì  ì´ì•¼ê¸°ë¥¼ ê¸°ë¡í•˜ê³  ì „ë‹¬í•˜ëŠ” ë° ê¸°ì—¬
     
      
  5. ë§ì¶¤í˜• ì •ë³´ ì œê³µ
       > ì‚¬ìš©ìì˜ ì§ˆë¬¸ì— ë”°ë¼ ì—­ì‚¬ì  ì •ë³´ë¥¼ ì •í™•í•˜ê³  ë¹ ë¥´ê²Œ ì œê³µí•¨ìœ¼ë¡œì¨, ê°œê°œì¸ì˜ í•„ìš”ì™€ ê´€ì‹¬ì‚¬ì— ì í•©í•œ ì •ë³´ë¥¼ ì œê³µ
       
       
âœ” **ì£¼ìš” ì‘ì—…**
   1. ë°ì´í„° ìˆ˜ì§‘

        > í”„ë¡œì íŠ¸ ì£¼ì œì— ë§ëŠ” ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ëŠ”ë°, ì •ë³´ì— í—ˆêµ¬ê°€ ì—†ê³  ì‹ ë¢°ë„ê°€ ë†’ì€ ìë£Œë¥¼ ì¸ìš©í•  ê²ƒ.
        > 
        > ì‹œê°í™” ìë£Œë¥¼ ì œì™¸í•˜ê³ , í…ìŠ¤íŠ¸ ìœ„ì£¼ì˜ ìë£Œë§Œ ë°›ì•„ì„œ ì‚¬ìš©í•œë‹¤.
        > 
        > êµ­ì‚¬í¸ì°¬ìœ„ì›íšŒì˜ ìë£Œ ì‚¬ìš© - http://contents.history.go.kr/front/kc/main.do#self
        > 
       
   2. ì „ì²˜ë¦¬
      
      > ì¤„ë°”ê¿ˆ, í•œìì–´ í¬í•¨ëœ ê²ƒì„ ì£¼ì˜í•˜ì—¬ ë°ì´í„° ê°€ê³µì„ í•œë‹¤.
      > 

   3. RAG ê¸°ë°˜ ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥
      >  ë°ì´í„° ë²¡í„°í™”, ì €ì¥ì†Œ êµ¬ì„±, ë©”íƒ€ë°ì´í„° ì¶”ê°€ë¥¼ í†µí•´ ê²€ìƒ‰ì„ í•  ìˆ˜ ìˆëŠ” ë°ì´í„°ë² ì´ìŠ¤ë¥¼ êµ¬ì¶•í•œë‹¤.
      > 
   
   4. LLM ì—°ë™
      
      >


![image](https://github.com/user-attachments/assets/85efb451-f6c8-4688-892f-28b6688cde6e)






## í”„ë¡œì íŠ¸ ì§„í–‰ ê³¼ì •
**â—ï¸ í™”ë©´ êµ¬ì„±ì€ ìƒëµí•˜ê³  RAGë¥¼ ìœ„í•œ ë°±ì—”ë“œ ì‹œìŠ¤í…œ êµ¬ì¶•ì— ì§‘ì¤‘ â—ï¸**
</br>
### 1. ë°ì´í„° ìˆ˜ì§‘ ë° ì „ì²˜ë¦¬

#### 1.1 ë°ì´í„° ìˆ˜ì§‘
  - **ëª©í‘œ**
    > í”„ë¡œì íŠ¸ ì£¼ì œì— ë§ëŠ” ë°ì´í„°ë¥¼ ìˆ˜ì§‘
    > 
  - **ë°©ë²•**
    > ê³µê°œ ë°ì´í„°ì…‹ ë‹¤ìš´ë¡œë“œ(ìš°ë¦¬ì—­ì‚¬ë„· í•œêµ­ì‚¬ì—°ëŒ€ê¸° PDFìë£Œ)
    >
    > ì¶”ê°€ë¡œ requestë¥¼ ì´ìš©í•˜ì—¬ í¬ë¡¤ë§ ì§„í–‰ í›„ ì €ì¥
    > 

#### 1.2 ë°ì´í„° ì „ì²˜ë¦¬
  - **ì‘ì—…**
    > í…ìŠ¤íŠ¸ ì •ì œ, ì¤‘ë³µ ì œê±°, ë¶ˆí•„ìš”í•œ ì •ë³´ ì‚­ì œ ë“±
    >
  - **ì½”ë“œ (Python)**
    ```
    full_text = [doc.page_content for doc in load_docs] 
    full_text = ''.join(full_text)
    full_text = re.sub(r"ê´€ë ¨ì‚¬ë£Œ", "", full_text)
    full_text = re.sub(r"\([ä¸€-é¾¥]+\)", "", full_text)
    full_text = re.sub(r"\n", "", full_text)
    ```



### 2. ë²¡í„°í™” ë° ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥

#### 2.1 í…ìŠ¤íŠ¸ ì„ë² ë”© ìƒì„±
  - **ëª©í‘œ**
    > í…ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ë²¡í„° í˜•íƒœë¡œ ë³€í™˜
    > 
  - **ë„êµ¬**
    > Sentence Transformers, Hugging Face Transformers ë“±
    > 

  - **ì½”ë“œ**
    ```
      # Split
      splitter = RecursiveCharacterTextSplitter.from_tiktoken_encoder(
          model_name=MODEL_NAME,
          chunk_size=CHUNK_SIZE,
          chunk_overlap=CHUNK_OVERLAP,
      )
      
      # Embedding ëª¨ë¸ ì´ˆê¸°í™”
      embedding_model = OpenAIEmbeddings(model=EMBEDDING_NAME)
    ```



#### 2.2 ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥
  - **ëª©í‘œ**
    > ìƒì„±ëœ ë²¡í„°ë¥¼ ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥
    > 
  - **ë„êµ¬**
    > 
    > 

  - **ì½”ë“œ**
    ```
    # Vector store ì—°ê²°
    vector_store = Chroma(
    collection_name=COLLECTION_NAME,
    persist_directory=PERSIST_DIRECTORY,
    embedding_function=embedding_model
    )
    ```



### 3. RAG ê¸°ë°˜ ì§ˆì˜ ì‘ë‹µ ì‹œìŠ¤í…œ êµ¬í˜„

#### 3.1 LLM ì—°ë™ ë° RAG Chain êµ¬ì„±
  - **ëª©í‘œ**
    > LLMê³¼ ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì—°ë™í•˜ì—¬ ì§ˆì˜ ì‘ë‹µ ì‹œìŠ¤í…œ êµ¬ì¶•
    > 
  - **ë„êµ¬**
    > OpenAI API, LangChain ë“±
    > 

  - **ì½”ë“œ**
    ```
    # LLM ì—°ë™
    from langchain_openai import ChatOpenAI
    from langchain.prompts import ChatPromptTemplate
    from langchain_core.output_parsers import StrOutputParser

    MODEL_NAME = 'gpt-4o'

    # LLM ëª¨ë¸ ì´ˆê¸°í™”
    model = ChatOpenAI(model=MODEL_NAME)

    # Prompt í…œí”Œë¦¿ ìƒì„±
    messages = [
       ("ai", """
       ë„ˆëŠ” í•œêµ­ì‚¬ì— ëŒ€í•´ì„œ í•´ë°•í•œ ì§€ì‹ì„ ê°€ì§„ ì—­ì‚¬ì „ë¬¸ê°€ì•¼.
       ë‚´ê°€ ì—­ì‚¬ì  ì¸ë¬¼ ë˜ëŠ” ì‚¬ê±´ì— ëŒ€í•´ ë§í•˜ë©´ ê·¸ ì¸ë¬¼ê³¼ ì‚¬ê±´ì„ ì´í•´ê°€ ì‰½ê²Œ, í¥ë¯¸ë¥¼ ìƒì§€ ì•Šê²Œ ì‰¬ìš´ìš©ì–´ë¡œ í’€ì–´ì„œ ì„¤ëª…í•´ì£¼ë©´ ë¼.
   
       ë¬¸ì„œì— ì—†ëŠ” ë‚´ìš©ì€ ë‹µë³€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ëª¨ë¥¸ë‹¤ê³  ë‹µë³€ í•˜ì„¸ìš”.

       ì¸ë¬¼ì˜ ì´ë¦„ :
       ì‹œëŒ€ :
       ì¸ë¬¼ì— ëŒ€í•´ ì•Œê³  ì‹¶ì€ ê²ƒ :
    {context}"""),
        ("human", "{question}"),
       ]
    prompt_template = ChatPromptTemplate(messages=messages)

    # Output parser
    parser = StrOutputParser()

    # Langchain êµ¬ì„±
    from langchain_core.runnables import RunnablePassthrough

    # Vector ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê²€ìƒ‰ ìˆ˜í–‰
    retriever = vector_store.as_retriever(search_type="mmr")

    # Chain êµ¬ì„± retriever(ê´€ë ¨ ë¬¸ì„œ ì¡°íšŒ) -> prompt_template(prompt ìƒì„±) model(ì •ë‹µ) -> output parser
    chain = {"context":retriever, "question":RunnablePassthrough()} | prompt_template | model | parser
    ```



### 4. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ë° ê°œì„ 

#### 4.1 ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
  - **ëª©í‘œ**
    > RAG ì‹œìŠ¤í…œì˜ ì§ˆì˜ ì‘ë‹µ ì„±ëŠ¥ í‰ê°€
    > 
  - **ë°©ë²•**
    > ì •í™•ì„±, ì‘ë‹µ ì†ë„ ë“± í‰ê°€ ì§€í‘œ ì„¤ì • ë° ì¸¡ì •
    > 
  - **ì½”ë“œ**
    ```
    ### í‰ê°€ ë°ì´í„°ë¡œ ì‚¬ìš©í•  context ì¶”ì¶œ
    total_samples = 4

    # index shuffle í›„ total_samplesë§Œí¼ context ì¶”ì¶œ

    idx_list = list(range(len(document_list)))
    random.shuffle(idx_list)

    eval_context_list = []
    while len(eval_context_list) < total_samples:
       idx = idx_list.pop()
       context = document_list[idx].page_content
       if len(context) > 100: # 100ê¸€ì ì´ìƒì¸ textë§Œ ì‚¬ìš©
           eval_context_list.append(context)

    len(eval_context_list)
    ```
#### 4.2 ê°œì„  ë° ìµœì í™”
  - **ì‘ì—…**

  - **ì½”ë“œ**
    ```
    
    ```

### í‰ê°€ ê²°ê³¼
   - context_recall': 0.7000
   - llm_context_precision_with_reference': 0.8833
   - faithfulness': 0.8358
   - answer_relevancy': 0.6326  
      



### Stack
- Environment
  
    ![Visual Studio Code](https://img.shields.io/badge/Visual%20Studio%20Code-007ACC?style=for-the-badge&logo=Visual%20Studio%20Code&logoColor=white)
    ![Github](https://img.shields.io/badge/GitHub-181717?style=for-the-badge&logo=GitHub&logoColor=white)

- Develpoment
  
    ![Python](https://img.shields.io/badge/python-3776AB?style=for-the-badge&logo=python&logoColor=white)
- Communication
  
    ![Discord](https://img.shields.io/badge/discord-5865F2?style=for-the-badge&logo=discord&logoColor=white)  

### íšŒê³ 
í˜•ì§„ 
>
>
í•´ì› 
>
>
ìˆ˜ì—° 
>
>
ì—°ê²½ 
>
>
ë¯¸í˜„ 
>
>

